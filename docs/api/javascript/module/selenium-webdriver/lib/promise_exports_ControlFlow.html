<!DOCTYPE html><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="Content-Language" content="en"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"><title>ControlFlow</title><link href="../../../dossier.css" rel="stylesheet" type="text/css"><header><button class="dossier-menu"><i class="material-icons">menu</i></button><form><input type="search" placeholder="Search" tabindex="1"><i class="material-icons">search</i></form></header><div class="content"><main><article><section class="intro"><div class="parentlink"><b>Module:</b> <a href="promise.html">selenium-webdriver/lib/promise</a></div><div class="codelink"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/promise.js#L3071" target="_blank">View Source</a></div><h1 class="title"><div class="tags"><span class="final"></span></div><div>class ControlFlow</div></h1><pre class="inheritance"><a href="events_exports_EventEmitter.html">EventEmitter</a>
  &#x2514; ControlFlow</pre><p>Handles the execution of scheduled tasks, each of which may be an
asynchronous operation. The control flow will ensure tasks are executed in
the ordered scheduled, starting each task only once those before it have
completed.</p>
<p>Each task scheduled within this flow may return a <a href="promise_exports_Promise.html"><code>ManagedPromise</code></a> to
indicate it is an asynchronous operation. The ControlFlow will wait for such
promises to be resolved before marking the task as completed.</p>
<p>Tasks and each callback registered on a <a href="promise_exports_Promise.html"><code>ManagedPromise</code></a> will be run
in their own ControlFlow frame.  Any tasks scheduled within a frame will take
priority over previously scheduled tasks. Furthermore, if any of the tasks in
the frame fail, the remainder of the tasks in that frame will be discarded
and the failure will be propagated to the user through the callback/task&#39;s
promised result.</p>
<p>Each time a ControlFlow empties its task queue, it will fire an
<code>IDLE</code> event. Conversely,
whenever the flow terminates due to an unhandled error, it will remove all
remaining tasks in its queue and fire an
<code>UNCAUGHT_EXCEPTION</code> event.
If there are no listeners registered with the flow, the error will be
rethrown to the global error handler.</p>
<p>Refer to the <a href="promise.html"><code>./promise</code></a> module documentation fora  detailed
explanation of how the ControlFlow coordinates task execution.</p>
<h3 class="name"><div>new ControlFlow()</div></h3><dt class="spec">Parameters</dt><dd><dl><dd><p>None.</p></dl></dd></section><section class="instance-methods"><h2>Instance Methods</h2><section class="property" id="addListener"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/events.js#L121" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>addListener(<wbr>type,<wbr> fn,<wbr> opt_self)</div></h3><p>Registers a listener.</p>
<dl><dt class="spec">Defined by</dt><dd><a href="events_exports_EventEmitter.html#addListener">EventEmitter</a></dd><dt class="spec">Parameters</dt><dd><dl><dt class="named">type<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code><dd><p>The type of event to listen for.</p>
<dt class="named">fn<code>!Function</code><dd><p>The function to invoke when the event is fired.</p>
<dt class="named">opt_self<code>?<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>=</code><dd><p>The object in whose scope to invoke the listener.</p>
</dl></dd><dt class="spec">Returns</dt><dd><dl><dt><code><a href="events_exports_EventEmitter.html">EventEmitter</a></code><dd><p>A self reference.</p>
</dl></dd></dl></section><section class="property" id="async"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/promise.js#L2291" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>async(<wbr>fn,<wbr> opt_self,<wbr> var_args)</div></h3><p>Executes a function in the next available turn of the JavaScript event
loop. This ensures the function runs with its own task queue and any
scheduled tasks will run in &#34;parallel&#34; to those scheduled in the current
function.</p>
<pre><code> flow.execute(() &#61;&gt; console.log(&#39;a&#39;));
 flow.execute(() &#61;&gt; console.log(&#39;b&#39;));
 flow.execute(() &#61;&gt; console.log(&#39;c&#39;));
 flow.async(() &#61;&gt; {
    flow.execute(() &#61;&gt; console.log(&#39;d&#39;));
    flow.execute(() &#61;&gt; console.log(&#39;e&#39;));
 });
 flow.async(() &#61;&gt; {
    flow.execute(() &#61;&gt; console.log(&#39;f&#39;));
    flow.execute(() &#61;&gt; console.log(&#39;g&#39;));
 });
 flow.once(&#39;idle&#39;, () &#61;&gt; console.log(&#39;fin&#39;));
 // a
 // d
 // f
 // b
 // e
 // g
 // c
 // fin
</code></pre>
<p>If the function itself throws, the error will be treated the same as an
unhandled rejection within the control flow.</p>
<p><strong>NOTE</strong>: This function is considered <em>unstable</em>.</p>
<dl><dt class="spec">Parameters</dt><dd><dl><dt class="named">fn<code>!Function</code><dd><p>The function to execute.</p>
<dt class="named">opt_self<code>?<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>=</code><dd><p>The object in whose context to run the function.</p>
<dt class="named">var_args<code>...*</code><dd><p>Any arguments to pass to the function.</p>
</dl></dd></dl></section><section class="property" id="emit"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/events.js#L53" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>emit(<wbr>type,<wbr> var_args)</div></h3><p>Fires an event and calls all listeners.</p>
<dl><dt class="spec">Defined by</dt><dd><a href="events_exports_EventEmitter.html#emit">EventEmitter</a></dd><dt class="spec">Parameters</dt><dd><dl><dt class="named">type<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code><dd><p>The type of event to emit.</p>
<dt class="named">var_args<code>...*</code><dd><p>Any arguments to pass to each listener.</p>
</dl></dd></dl></section><section class="property" id="execute"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/promise.js#L2112" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div><code class="template-name">&lt;T&gt;</code> execute(<wbr>fn,<wbr> opt_description)</div></h3><p>Schedules a task for execution. If there is nothing currently in the
queue, the task will be executed in the next turn of the event loop. If
the task function is a generator, the task will be executed using
<a href="promise.html#consume"><code>consume()</code></a>.</p>
<dl><dt class="spec">Parameters</dt><dd><dl><dt class="named">fn<code>function(): (T|<a href="promise_exports_Promise.html">Promise</a>&lt;T&gt;)</code><dd><p>The function to
call to start the task. If the function returns a
<a href="promise_exports_Promise.html"><code>ManagedPromise</code></a>, this instance will wait for it to be
resolved before starting the next task.</p>
<dt class="named">opt_description<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>=</code><dd><p>A description of the task.</p>
</dl></dd><dt class="spec">Returns</dt><dd><dl><dt><code><a href="promise_exports_Promise.html">Promise</a>&lt;T&gt;</code><dd><p>A promise that will be resolved
with the result of the action.</p>
</dl></dd></dl></section><section class="property" id="getSchedule"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/promise.js#L2024" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>getSchedule(<wbr>opt_includeStackTraces)</div></h3><p>Generates an annotated string describing the internal state of this control
flow, including the currently executing as well as pending tasks. If
<code>opt_includeStackTraces &#61;&#61;&#61; true</code>, the string will include the
stack trace from when each task was scheduled.</p>
<dl><dt class="spec">Parameters</dt><dd><dl><dt class="named">opt_includeStackTraces<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>=</code><dd><p>Whether to include the stack traces
from when each task was scheduled. Defaults to false.</p>
</dl></dd><dt class="spec">Returns</dt><dd><dl><dt><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code><dd><p>String representation of this flow&#39;s internal state.</p>
</dl></dd></dl></section><section class="property" id="isIdle"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/promise.js#L2001" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>isIdle()</div></h3><dl><dt class="spec">Returns</dt><dd><dl><dt><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean">boolean</a></code><dd><p>Whether this flow is currently idle.</p>
</dl></dd></dl></section><section class="property" id="listeners"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/events.js#L78" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>listeners(<wbr>type)</div></h3><p>Returns a mutable list of listeners for a specific type of event.</p>
<dl><dt class="spec">Defined by</dt><dd><a href="events_exports_EventEmitter.html#listeners">EventEmitter</a></dd><dt class="spec">Parameters</dt><dd><dl><dt class="named">type<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code><dd><p>The type of event to retrieve the listeners for.</p>
</dl></dd><dt class="spec">Returns</dt><dd><dl><dt><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a>&lt;<a href="events_exports_Listener.html">Listener</a>&gt;</code><dd><p>The registered listeners for the given event
type.</p>
</dl></dd></dl></section><section class="property" id="on"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/events.js#L144" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>on(<wbr>type,<wbr> fn,<wbr> opt_self)</div></h3><p>An alias for <a href="promise_exports_ControlFlow.html#addListener"><code>addListener()</code></a>.</p>
<dl><dt class="spec">Defined by</dt><dd><a href="events_exports_EventEmitter.html#on">EventEmitter</a></dd><dt class="spec">Parameters</dt><dd><dl><dt class="named">type<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code><dd><p>The type of event to listen for.</p>
<dt class="named">fn<code>!Function</code><dd><p>The function to invoke when the event is fired.</p>
<dt class="named">opt_self<code>?<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>=</code><dd><p>The object in whose scope to invoke the listener.</p>
</dl></dd><dt class="spec">Returns</dt><dd><dl><dt><code><a href="events_exports_EventEmitter.html">EventEmitter</a></code><dd><p>A self reference.</p>
</dl></dd></dl></section><section class="property" id="once"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/events.js#L133" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>once(<wbr>type,<wbr> fn,<wbr> opt_self)</div></h3><p>Registers a one-time listener which will be called only the first time an
event is emitted, after which it will be removed.</p>
<dl><dt class="spec">Defined by</dt><dd><a href="events_exports_EventEmitter.html#once">EventEmitter</a></dd><dt class="spec">Parameters</dt><dd><dl><dt class="named">type<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code><dd><p>The type of event to listen for.</p>
<dt class="named">fn<code>!Function</code><dd><p>The function to invoke when the event is fired.</p>
<dt class="named">opt_self<code>?<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>=</code><dd><p>The object in whose scope to invoke the listener.</p>
</dl></dd><dt class="spec">Returns</dt><dd><dl><dt><code><a href="events_exports_EventEmitter.html">EventEmitter</a></code><dd><p>A self reference.</p>
</dl></dd></dl></section><section class="property" id="removeAllListeners"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/events.js#L192" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>removeAllListeners(<wbr>opt_type)</div></h3><p>Removes all listeners for a specific type of event. If no event is
specified, all listeners across all types will be removed.</p>
<dl><dt class="spec">Defined by</dt><dd><a href="events_exports_EventEmitter.html#removeAllListeners">EventEmitter</a></dd><dt class="spec">Parameters</dt><dd><dl><dt class="named">opt_type<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>=</code><dd><p>The type of event to remove listeners from.</p>
</dl></dd><dt class="spec">Returns</dt><dd><dl><dt><code><a href="events_exports_EventEmitter.html">EventEmitter</a></code><dd><p>A self reference.</p>
</dl></dd></dl></section><section class="property" id="removeListener"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/events.js#L154" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>removeListener(<wbr>type,<wbr> listenerFn)</div></h3><p>Removes a previously registered event listener.</p>
<dl><dt class="spec">Defined by</dt><dd><a href="events_exports_EventEmitter.html#removeListener">EventEmitter</a></dd><dt class="spec">Parameters</dt><dd><dl><dt class="named">type<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code><dd><p>The type of event to unregister.</p>
<dt class="named">listenerFn<code>!Function</code><dd><p>The handler function to remove.</p>
</dl></dd><dt class="spec">Returns</dt><dd><dl><dt><code><a href="events_exports_EventEmitter.html">EventEmitter</a></code><dd><p>A self reference.</p>
</dl></dd></dl></section><section class="property" id="reset"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/promise.js#L2008" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>reset()</div></h3><p>Resets this instance, clearing its queue and removing all event listeners.</p>
</section><section class="property" id="setPropagateUnhandledRejections"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/promise.js#L1994" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>setPropagateUnhandledRejections(<wbr>propagate)</div></h3><p>Sets whether any unhandled rejections should propagate up through the
control flow stack and cause rejections within parent tasks. If error
propagation is disabled, tasks will not be aborted when an unhandled
promise rejection is detected, but the rejection <em>will</em> trigger an
<code>ControlFlow.EventType.UNCAUGHT_EXCEPTION</code>
event.</p>
<p>The default behavior is to propagate all unhandled rejections. <em>The use
of this option is highly discouraged.</em></p>
<dl><dt class="spec">Parameters</dt><dd><dl><dt class="named">propagate<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean">boolean</a></code><dd><p>whether to propagate errors.</p>
</dl></dd></dl></section><section class="property" id="timeout"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/promise.js#L2142" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>timeout(<wbr>ms,<wbr> opt_description)</div></h3><p>Inserts a <code>setTimeout</code> into the command queue. This is equivalent to
a thread sleep in a synchronous programming language.</p>
<dl><dt class="spec">Parameters</dt><dd><dl><dt class="named">ms<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number">number</a></code><dd><p>The timeout delay, in milliseconds.</p>
<dt class="named">opt_description<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>=</code><dd><p>A description to accompany the timeout.</p>
</dl></dd><dt class="spec">Returns</dt><dd><dl><dt><code><a href="promise_exports_Promise.html">Promise</a></code><dd><p>A promise that will be resolved with
the result of the action.</p>
</dl></dd></dl></section><section class="property" id="toString"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/promise.js#L1977" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div>toString()</div></h3><p>Returns a string representation of this control flow, which is its current
<a href="promise_exports_ControlFlow.html#getSchedule">schedule</a>, sans task stack traces.</p>
<dl><dt class="spec">Returns</dt><dd><dl><dt><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code><dd><p>The string representation of this contorl flow.</p>
</dl></dd></dl></section><section class="property" id="wait"><div class="code-link"><a href="https://github.com/SeleniumHQ/selenium/tree/master/javascript/node/selenium-webdriver/lib/promise.js#L2185" target="_blank" title="View source"><i class="material-icons">code</i></a></div><h3 class="name"><div><code class="template-name">&lt;T&gt;</code> wait(<wbr>condition,<wbr> opt_timeout,<wbr> opt_message)</div></h3><p>Schedules a task that shall wait for a condition to hold. Each condition
function may return any value, but it will always be evaluated as a
boolean.</p>
<p>Condition functions may schedule sub-tasks with this instance, however,
their execution time will be factored into whether a wait has timed out.</p>
<p>In the event a condition returns a ManagedPromise, the polling loop will wait for
it to be resolved before evaluating whether the condition has been
satisfied. The resolution time for a promise is factored into whether a
wait has timed out.</p>
<p>If the condition function throws, or returns a rejected promise, the
wait task will fail.</p>
<p>If the condition is defined as a promise, the flow will wait for it to
settle. If the timeout expires before the promise settles, the promise
returned by this function will be rejected.</p>
<p>If this function is invoked with <code>timeout &#61;&#61;&#61; 0</code>, or the timeout is
omitted, the flow will wait indefinitely for the condition to be satisfied.</p>
<dl><dt class="spec">Parameters</dt><dd><dl><dt class="named">condition<code>(<a href="promise_exports_Promise.html">Promise</a>&lt;T&gt;|function(): ?)</code><dd><p>The condition to poll,
or a promise to wait on.</p>
<dt class="named">opt_timeout<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number">number</a>=</code><dd><p>How long to wait, in milliseconds, for the
condition to hold before timing out. If omitted, the flow will wait
indefinitely.</p>
<dt class="named">opt_message<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>=</code><dd><p>An optional error message to include if the
wait times out; defaults to the empty string.</p>
</dl></dd><dt class="spec">Returns</dt><dd><dl><dt><code><a href="promise_exports_Promise.html">Promise</a>&lt;T&gt;</code><dd><p>A promise that will be fulfilled
when the condition has been satisified. The promise shall be rejected
if the wait times out waiting for the condition.</p>
</dl></dd><dt class="spec">Throws</dt><dd><dl><dt><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypeError">TypeError</a></code><dd><p>If condition is not a function or promise or if timeout
is not a number &gt;&#61; 0.</p>
</dl></dd></dl></section></section><section class="types"><h2>Types</h2><section class="property"><dl><dt><a href="promise_exports_ControlFlow.EventType.html">ControlFlow.EventType</a><dd><p>Events that may be emitted by an <a href="promise_exports_ControlFlow.html"><code>ControlFlow</code></a>.</p>
</dl></section></section></article></main><footer><div><a href="https://github.com/jleyba/js-dossier">Generated by dossier</a></div></footer></div><nav class="dossier-nav"><section><a class="title" href="../../../index.html" tabindex="2">Overview</a></section><section class="modules"><div class="toggle"><div class="title"><span class="item" tabindex="2">Modules</span><i class="material-icons">expand_more</i></div></div></section><section><a class="title" href="../../../Changes.html" tabindex="2">Changes</a></section></nav><script src="../../../types.js"></script><script src="../../../dossier.js"></script>